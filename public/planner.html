<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>ITravelByMyOwn Â· Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="https://cdn.prod.website-files.com/img/favicon.ico" />

  <!-- CSS LOCAL del planner -->
  <link id="itbmo-css" rel="stylesheet" href="./planner.css" />

  <!-- TipografÃ­a -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Carga Inter por CSS como fallback rÃ¡pido -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- WebFont loader (opcional). Si falla, NO rompe. -->
  <script defer src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
  <script>
    // No bloquea render. Si WebFont no carga, el link CSS de arriba ya cubre.
    window.addEventListener('DOMContentLoaded', function () {
      try {
        if (window.WebFont && typeof window.WebFont.load === 'function') {
          window.WebFont.load({ google: { families: ["Inter:400,500,600,700"] } });
        }
      } catch (_) { /* no-op */ }
    });
  </script>
</head>

<body>

  <!-- =========================
       TOP BAR
  ========================== -->
  <div class="planner-topbar">
    <div class="planner-brand">
      <span class="planner-brand-title">ITravelByMyOwn Planner</span>
      <span id="planner-version-pill" class="planner-pill">vâ€”</span>
    </div>

    <div class="planner-topbar-actions">
      <button id="info-chat-floating" class="planner-btn planner-btn-ghost" type="button">
        ðŸ’¬ Info Chat
      </button>
      <button id="reset-planner" class="planner-btn planner-btn-danger" type="button">
        Reset
      </button>
    </div>
  </div>

  <!-- =========================
       GRID LAYOUT
  ========================== -->
  <div class="planner-grid">

    <!-- =========================
         SIDEBAR
    ========================== -->
    <aside class="planner-sidebar">
      <div class="planner-card">
        <h2 class="planner-h2">Destinos</h2>
        <p class="planner-muted">
          Ingresa tus ciudades, dÃ­as y fecha base. Luego pulsa <b>Guardar destinos</b>.
        </p>

        <div id="city-list" class="planner-city-list"></div>

        <div class="planner-row planner-row-gap">
          <button id="add-city" class="planner-btn" type="button">+ Agregar ciudad</button>
          <button id="save-destinations" class="planner-btn planner-btn-primary" type="button">Guardar destinos</button>
        </div>
      </div>

      <div class="planner-card">
        <h2 class="planner-h2">Preferencias</h2>

        <div class="planner-field">
          <label class="planner-label">Condiciones especiales</label>
          <textarea id="special-conditions" class="planner-textarea" placeholder="Ej. movilidad limitada, ritmo relajado, cenas icÃ³nicas, auroras, etc."></textarea>
        </div>

        <div class="planner-row">
          <button id="start-planning" class="planner-btn planner-btn-primary" type="button" disabled>
            Iniciar planificaciÃ³n
          </button>
        </div>
      </div>

      <div class="planner-card planner-card-note">
        <p class="planner-muted">
          <b>Regla clave:</b> El itinerario lo decide el <b>Info Chat interno</b>. El Planner solo protege la estructura.
        </p>
      </div>
    </aside>

    <!-- =========================
         MAIN
    ========================== -->
    <main class="planner-main">
      <div class="planner-card">
        <h2 class="planner-h2">Itinerario</h2>
        <div id="itinerary-container" class="planner-itinerary"></div>
      </div>
    </main>

  </div>

  <!-- =========================
       OVERLAY WOW
  ========================== -->
  <div id="overlay-wow" class="planner-overlay" style="display:none;">
    <div class="planner-overlay-card">
      <div class="planner-spinner"></div>
      <p>Astra estÃ¡ generando itinerariosâ€¦</p>
    </div>
  </div>

  <!-- =========================
       INFO CHAT PANEL (Floating)
  ========================== -->
  <div id="info-chat-panel" class="info-chat-panel" style="display:none;">
    <div class="info-chat-header">
      <div class="info-chat-title">Info Chat</div>
      <button id="info-chat-close" class="planner-btn planner-btn-ghost" type="button">âœ•</button>
    </div>

    <div id="info-chat-messages" class="info-chat-messages"></div>

    <!-- Typing Indicator (Planner) -->
    <div id="thinking-indicator">
      <span></span><span></span><span></span>
    </div>

    <div class="info-chat-inputbar">
      <input id="info-chat-input" class="info-chat-input" placeholder="PregÃºntame cualquier cosa del destinoâ€¦" />
      <button id="info-chat-send" class="planner-btn planner-btn-primary" type="button">Enviar</button>
    </div>
  </div>

  <!-- =========================
       PATCH QUIRÃšRGICO: placeholders â€œupsellâ€ para evitar null refs si planner.js los busca
  ========================== -->
  <div id="upsell-modal" style="display:none;"></div>
  <div id="upsell-overlay" style="display:none;"></div>

  <!-- =========================
       JS LOADER (v desde querystring)
       - Elimina hardcode v=57
       - Mantiene coherencia con Embed v=79.xx
  ========================== -->
  <script>
    (function(){
      try{
        const qs = new URLSearchParams(location.search);
        const v = (qs.get('v')||'').trim();

        // CSS cache-bust coherente con el iframe
        const css = document.getElementById('itbmo-css');
        if(css && v) css.href = './planner.css?v=' + encodeURIComponent(v);

        // Badge visible
        const pill = document.getElementById('planner-version-pill');
        if(pill) pill.textContent = v ? ('v' + v) : 'vâ€”';

        // JS cache-bust coherente con el iframe
        const s = document.createElement('script');
        s.src = v ? ('./planner.js?v=' + encodeURIComponent(v)) : './planner.js';
        document.body.appendChild(s);
      }catch(_){
        const s = document.createElement('script');
        s.src = './planner.js';
        document.body.appendChild(s);
      }
    })();
  </script>

</body>
</html>
