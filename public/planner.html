<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ITravelByMyOwn Â· Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://cdn.prod.website-files.com/img/favicon.ico" />
  <link rel="stylesheet" href="./planner.css?v=57" />

  <!-- TipografÃ­a -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous" />
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
  <script>
    WebFont.load({ google: { families: ["Inter:400,500,600,700"] } });
  </script>
</head>
<body>
  <!-- TOPBAR -->
  <div class="topbar">
    <!-- âœ… Brand estilo logo (2 lÃ­neas) -->
    <div class="brand brand-logo" aria-label="I Travel By My Own">
      <div class="brand-line-1">I Travel</div>
      <div class="brand-line-2">By My Own</div>
    </div>

    <!-- âœ… MVP: Se elimina botÃ³n de topbar para dejar SOLO el flotante -->
    <!-- <button id="info-chat-toggle" class="btn info-chat-btn pulse" title="Open Info Chat">ğŸ’¬ Info Chat</button> -->
  </div>

  <div id="planner-grid">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h2>Planificador</h2>

      <section class="box">
        <h3>Destinos</h3>
        <div id="city-list"></div>
        <div class="row-actions">
          <button class="btn ghost" id="add-city-btn">+ Agregar ciudad</button>
        </div>
        <button class="btn primary w-100" id="save-destinations">Guardar destinos</button>
        <!-- ğŸ†• BotÃ³n de reinicio reubicado -->
        <button id="reset-planner" class="btn warn w-100" style="margin-top:0.5rem;" disabled>
          Reiniciar planificaciÃ³n
        </button>
      </section>

      <section class="box special-conditions">
        <h3>Preferencias / Restricciones / Condiciones especiales</h3>
        <textarea id="special-conditions" placeholder="âœ¨ CuÃ©ntale a Astra exactamente cÃ³mo quieres vivir tu viaje.
Esta informaciÃ³n permitirÃ¡ crear un itinerario 100 % alineado contigo.

ğŸï¸ Estilo y actividades â†’ â€œPrefiero naturaleza y paisajes. Evitar museos.â€ / â€œQuiero tours autÃ©nticos, no masivos.â€
ğŸš— Transporte â†’ â€œVoy a rentar un 4x4.â€ / â€œUsarÃ© transporte pÃºblico.â€ / â€œUber o taxi cuando sea necesario.â€
ğŸƒ Ritmo y nivel de aventura â†’ â€œViaje relax.â€ / â€œBalanceado.â€ / â€œAventura extrema.â€
ğŸ§­ Actividades imperdibles â†’ â€œCaza de auroras.â€ / â€œAvistamiento de ballenas.â€ / â€œTour al CÃ­rculo Dorado.â€
âš•ï¸ Salud y restricciones â†’ â€œAsma, movilidad reducida, problemas de rodillas, alergias alimentarias.â€
ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Otros detalles importantes â†’ â€œViajo con niÃ±os pequeÃ±os.â€ / â€œNecesito horarios flexibles.â€ / â€œEvitar caminatas largas.â€

ğŸ“ Entre mÃ¡s detalles indiques, mÃ¡s preciso, fluido y personalizado serÃ¡ tu itinerario."></textarea>
      </section>

      <!-- âœ… NUEVO: Viajeros (compacto con dropdown) -->
      <section class="box">
        <h3>Viajeros</h3>

        <!-- Dropdown tipo â€œnÃºmero de dÃ­asâ€ (referencia visual en el UI) -->
        <label style="display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
          Â¿Con quiÃ©n viajas?
          <select id="traveler-mode" class="btn" style="padding:.55rem .7rem; border-radius:.55rem; background:#fff; text-align:left;">
            <option value="" selected disabled></option>
            <option value="solo">Viajo solamente yo</option>
            <option value="group">Viajo acompaÃ±ado</option>
          </select>
        </label>

        <!-- Panel SOLO -->
        <div id="traveler-solo-panel" style="display:none; margin-top:.85rem;">
          <div style="display:flex; gap:.6rem; flex-wrap:wrap;">
            <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
              GÃ©nero
              <select id="solo-gender" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                <option value="" selected disabled></option>
                <option value="female">Femenino</option>
                <option value="male">Masculino</option>
                <option value="other">Otro</option>
                <option value="na">Prefiero no decirlo</option>
              </select>
            </label>

            <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
              Rango de edad
              <select id="solo-age-range" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                <option value="" selected disabled></option>
                <option value="0-2">BebÃ© (0â€“2)</option>
                <option value="3-5">Preescolar (3â€“5)</option>
                <option value="6-12">NiÃ±o (6â€“12)</option>
                <option value="13-17">Adolescente (13â€“17)</option>
                <option value="18-24">Joven adulto (18â€“24)</option>
                <option value="25-39">Adulto (25â€“39)</option>
                <option value="40-54">Adulto (40â€“54)</option>
                <option value="55-64">Adulto (55â€“64)</option>
                <option value="65+">Mayor (65+)</option>
              </select>
            </label>
          </div>
        </div>

        <!-- Panel ACOMPAÃ‘ADO -->
        <div id="traveler-group-panel" style="display:none; margin-top:.85rem;">

          <!-- âœ… NUEVO: Tu informaciÃ³n (usuario) -->
          <div class="box" style="margin:0 0 .75rem 0; padding:.9rem; border-style:dashed;">
            <strong style="font-size:.95rem;">Tu informaciÃ³n</strong>

            <div style="display:flex; gap:.6rem; flex-wrap:wrap; margin-top:.75rem;">
              <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
                GÃ©nero
                <select id="me-gender" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                  <option value="" selected disabled></option>
                  <option value="female">Femenino</option>
                  <option value="male">Masculino</option>
                  <option value="other">Otro</option>
                  <option value="na">Prefiero no decirlo</option>
                </select>
              </label>

              <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
                Rango de edad
                <select id="me-age-range" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                  <option value="" selected disabled></option>
                  <option value="0-2">BebÃ© (0â€“2)</option>
                  <option value="3-5">Preescolar (3â€“5)</option>
                  <option value="6-12">NiÃ±o (6â€“12)</option>
                  <option value="13-17">Adolescente (13â€“17)</option>
                  <option value="18-24">Joven adulto (18â€“24)</option>
                  <option value="25-39">Adulto (25â€“39)</option>
                  <option value="40-54">Adulto (40â€“54)</option>
                  <option value="55-64">Adulto (55â€“64)</option>
                  <option value="65+">Mayor (65+)</option>
                </select>
              </label>
            </div>
          </div>
          <!-- /Tu informaciÃ³n -->

          <div class="box" style="margin:0; padding:.9rem; border-style:dashed;">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:.75rem;">
              <strong style="font-size:.95rem;">Perfiles de viajeros</strong>
              <!-- MVP: el JS luego generarÃ¡ perfiles automÃ¡ticamente.
                   Por ahora dejamos contenedor + botones opcionales para futuro -->
              <div style="display:flex; gap:.4rem;">
                <button id="traveler-add" class="btn ghost" type="button" style="padding:.45rem .7rem;">+ Agregar</button>
                <button id="traveler-remove" class="btn ghost" type="button" style="padding:.45rem .7rem;">âˆ’ Quitar</button>
              </div>
            </div>

            <div id="traveler-profiles" style="display:grid; grid-template-columns:1fr; gap:.75rem; margin-top:.75rem;">
              <!-- Perfil 1 -->
              <div class="traveler-profile" style="border:1px solid #ccc; border-radius:.8rem; padding:.75rem;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:.5rem;">
                  <strong style="font-size:.9rem;">Viajero 1</strong>
                  <span style="font-size:.85rem; color:rgba(11,31,59,.65);">AcompaÃ±ante</span>
                </div>
                <div style="display:flex; gap:.6rem; flex-wrap:wrap;">
                  <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
                    GÃ©nero
                    <select class="traveler-gender" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                      <option value="" selected disabled></option>
                      <option value="female">Femenino</option>
                      <option value="male">Masculino</option>
                      <option value="other">Otro</option>
                      <option value="na">Prefiero no decirlo</option>
                    </select>
                  </label>

                  <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
                    Rango de edad
                    <select class="traveler-age-range" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                      <option value="" selected disabled></option>
                      <option value="0-2">BebÃ© (0â€“2)</option>
                      <option value="3-5">Preescolar (3â€“5)</option>
                      <option value="6-12">NiÃ±o (6â€“12)</option>
                      <option value="13-17">Adolescente (13â€“17)</option>
                      <option value="18-24">Joven adulto (18â€“24)</option>
                      <option value="25-39">Adulto (25â€“39)</option>
                      <option value="40-54">Adulto (40â€“54)</option>
                      <option value="55-64">Adulto (55â€“64)</option>
                      <option value="65+">Mayor (65+)</option>
                    </select>
                  </label>
                </div>
              </div>
              <!-- /Perfil 1 -->
            </div>

            <p style="margin:.75rem 0 0; font-size:.85rem; color:rgba(11,31,59,.68);">
              *En el MVP, estos perfiles se usarÃ¡n para personalizar el itinerario. La lÃ³gica se conecta en JS despuÃ©s.
            </p>
          </div>
        </div>

        <!-- âœ… Compatibilidad: mantenemos el grid original oculto (por ahora) para no romper JS actual -->
        <div id="traveler-grid" style="display:none;">
          <label>Adultos (18â€“64)<input id="p-adults" type="number" min="0" value="1"></label>
          <label>JÃ³venes (13â€“17)<input id="p-young" type="number" min="0" value="0"></label>
          <label>NiÃ±os (6â€“12)<input id="p-children" type="number" min="0" value="0"></label>
          <label>Infantes (0â€“5)<input id="p-infants" type="number" min="0" value="0"></label>
          <label>Mayores (65+)<input id="p-seniors" type="number" min="0" value="0"></label>
        </div>
      </section>

      <!-- âœ… Se eliminÃ³ la secciÃ³n de Presupuesto del sidebar -->
    </aside>

    <!-- MAIN -->
    <main class="main">
      <section class="box itinerary-section">

        <!-- âœ… Header: TÃ­tulo + botÃ³n Info Chat arriba (como el HTML donde sÃ­ se veÃ­a) -->
        <div class="itinerary-head">
          <h2>Itinerario</h2>

          <!-- âœ… BotÃ³n Info Chat (WOW) en la posiciÃ³n solicitada -->
          <button id="info-chat-floating" class="info-chat-floating pulse" title="Open Info Chat">
            ğŸ’¬ Info Chat
          </button>
        </div>

        <div class="itinerary-actions">
          <button id="start-planning" class="btn primary" disabled>Iniciar planificaciÃ³n</button>
        </div>

        <div id="chat-container" class="chat" style="display:none;">
          <div id="chat-messages" class="chat-messages" aria-live="polite"></div>
          <div class="chat-input">
            <input id="chat-input" type="text" placeholder="Escribe tu mensaje..." />
            <button id="send-btn" class="btn primary">Enviar</button>
          </div>
        </div>

        <div class="city-tabs" id="city-tabs"></div>
        <div id="itinerary-container"></div>

        <div class="toolbar">
          <button class="btn" id="btn-pdf">Exportar PDF</button>

          <!-- ğŸ†• MVP: CSV para Excel -->
          <button class="btn" id="btn-csv">Exportar CSV (Excel)</button>

          <button class="btn" id="btn-email">Enviar por Email</button>

          <!-- âœ… MVP: ocultos (se reactivan despuÃ©s) -->
          <!--
          <button class="btn" id="btn-maps">Mapas</button>
          <button class="btn" id="btn-transport">Transporte</button>
          <button class="btn" id="btn-weather">Clima</button>
          <button class="btn" id="btn-clothing">Ropa</button>
          <button class="btn" id="btn-restaurants">Restaurantes</button>
          <button class="btn" id="btn-gas">Gasolineras</button>
          <button class="btn" id="btn-bathrooms">BaÃ±os</button>
          <button class="btn" id="btn-lodging">Hospedaje</button>
          <button class="btn" id="btn-localinfo">Info Local</button>
          -->
        </div>

        <!-- âœ… QUIRÃšRGICO: oculto/eliminado por ahora -->
        <!-- <button id="confirm-itinerary" class="btn primary w-100" style="margin-top:1rem;">Elijo este itinerario</button> -->
      </section>
    </main>
  </div>

  <footer class="footer">
    Â© 2026 ITravelByMyOwn
  </footer>

  <!-- Modal Info Chat -->
  <!-- âœ… Cambio quirÃºrgico: removido style="display:none;" para que el toggle por clase .active funcione -->
  <div id="info-chat-modal" class="info-chat-modal">
    <div class="info-chat-panel">
      <div class="info-chat-header">
        <h3>Info Chat Â· Astra ğŸŒ</h3>
        <button id="info-chat-close" class="btn ghost">âœ–</button>
      </div>
      <div id="info-chat-messages" class="chat-messages"></div>
      <div class="chat-input">
        <textarea id="info-chat-input" placeholder="Ask me anything about travel..." rows="1"></textarea>
        <button id="info-chat-send" class="btn primary">Send</button>
      </div>
    </div>
  </div>

  <!-- Overlay de carga -->
  <div id="loading-overlay" style="display:none;">
    <div class="loader">
      <div class="hourglass"></div>

      <!-- âœ… Mensaje EXACTO solicitado -->
      <p>âœ¨ Astra estÃ¡ creando tu itinerario completoâ€¦ Esto puede tardar varios minutos. No cierres esta pestaÃ±a: estÃ¡s ahorrando horas de planificaciÃ³n.</p>
    </div>
  </div>

  <!-- ğŸ§  Indicador estilo ChatGPT (Planner) -->
  <div id="thinking-indicator">
    <span></span><span></span><span></span>
  </div>

  <!-- ğŸ§  Indicador estilo ChatGPT (Info Chat) -->
  <div id="thinking-indicator-info">
    <span></span><span></span><span></span>
  </div>

  <script>
    (function () {
      // âœ… Idioma: por ahora EN primero, luego ES con &lang=es en el iframe src.
      const params = new URLSearchParams(window.location.search);
      const lang = (params.get("lang") || "en").toLowerCase().slice(0, 2);
      document.documentElement.setAttribute("lang", lang);
      window.ITBMO_LANG = lang;

      // âœ… i18n (quirÃºrgico): UI EN/ES sin reescribir HTML ni tocar planner.js aÃºn
      const I18N = {
        en: {
          planner_title: "Planner",
          destinations: "Destinations",
          add_city: "+ Add city",
          save_destinations: "Save destinations",
          reset_planning: "Reset planning",
          special_title: "Preferences / Restrictions / Special conditions",
          travelers_title: "Travelers",
          who_travel: "Who are you traveling with?",
          mode_solo: "Just me",
          mode_group: "With others",
          gender: "Gender",
          age_range: "Age range",
          female: "Female",
          male: "Male",
          other: "Other",
          na: "Prefer not to say",
          baby: "Baby (0â€“2)",
          preschool: "Preschool (3â€“5)",
          child: "Child (6â€“12)",
          teen: "Teen (13â€“17)",
          young_adult: "Young adult (18â€“24)",
          adult_25_39: "Adult (25â€“39)",
          adult_40_54: "Adult (40â€“54)",
          adult_55_64: "Adult (55â€“64)",
          senior: "Senior (65+)",
          your_info: "Your info",
          traveler_profiles: "Traveler profiles",
          add: "+ Add",
          remove: "âˆ’ Remove",
          traveler_1: "Traveler 1",
          companion: "Companion",
          mvp_note: "*In the MVP, these profiles will be used to personalize the itinerary. The logic connects in JS later.",
          itinerary_title: "Itinerary",
          open_info_chat: "Open Info Chat",
          start_planning: "Start planning",
          type_message: "Type your message...",
          send: "Send",
          export_pdf: "Export PDF",
          export_csv: "Export CSV (Excel)",
          email: "Send by Email",
          choose_itinerary: "Choose this itinerary",
          info_header: "Info Chat Â· Astra ğŸŒ",
          info_placeholder: "Ask me anything...",
          loading_text: "âœ¨ Astra is creating your full itineraryâ€¦ This may take several minutes. Donâ€™t close this tab: youâ€™re saving hours of planning.",
          special_placeholder:
`âœ¨ Tell Astra exactly how you want to live your trip.
This will help create an itinerary that truly matches you.

ğŸï¸ Style & activities â†’ â€œI prefer nature and landscapes. Avoid museums.â€ / â€œI want authentic tours, not massive ones.â€
ğŸš— Transportation â†’ â€œIâ€™ll rent a 4x4.â€ / â€œIâ€™ll use public transport.â€ / â€œUber or taxi when needed.â€
ğŸƒ Pace & adventure level â†’ â€œRelaxed trip.â€ / â€œBalanced.â€ / â€œExtreme adventure.â€
ğŸ§­ Must-dos â†’ â€œNorthern lights hunt.â€ / â€œWhale watching.â€ / â€œGolden Circle tour.â€
âš•ï¸ Health & restrictions â†’ â€œAsthma, reduced mobility, knee issues, food allergies.â€
ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Other important details â†’ â€œTraveling with small kids.â€ / â€œNeed flexible hours.â€ / â€œAvoid long walks.â€

ğŸ“ The more details you share, the more precise, smooth and personalized your itinerary will be.`
        },
        es: {
          planner_title: "Planificador",
          destinations: "Destinos",
          add_city: "+ Agregar ciudad",
          save_destinations: "Guardar destinos",
          reset_planning: "Reiniciar planificaciÃ³n",
          special_title: "Preferencias / Restricciones / Condiciones especiales",
          travelers_title: "Viajeros",
          who_travel: "Â¿Con quiÃ©n viajas?",
          mode_solo: "Viajo solamente yo",
          mode_group: "Viajo acompaÃ±ado",
          gender: "GÃ©nero",
          age_range: "Rango de edad",
          female: "Femenino",
          male: "Masculino",
          other: "Otro",
          na: "Prefiero no decirlo",
          baby: "BebÃ© (0â€“2)",
          preschool: "Preescolar (3â€“5)",
          child: "NiÃ±o (6â€“12)",
          teen: "Adolescente (13â€“17)",
          young_adult: "Joven adulto (18â€“24)",
          adult_25_39: "Adulto (25â€“39)",
          adult_40_54: "Adulto (40â€“54)",
          adult_55_64: "Adulto (55â€“64)",
          senior: "Mayor (65+)",
          your_info: "Tu informaciÃ³n",
          traveler_profiles: "Perfiles de viajeros",
          add: "+ Agregar",
          remove: "âˆ’ Quitar",
          traveler_1: "Viajero 1",
          companion: "AcompaÃ±ante",
          mvp_note: "*En el MVP, estos perfiles se usarÃ¡n para personalizar el itinerario. La lÃ³gica se conecta en JS despuÃ©s.",
          itinerary_title: "Itinerario",
          open_info_chat: "Open Info Chat",
          start_planning: "Iniciar planificaciÃ³n",
          type_message: "Escribe tu mensaje...",
          send: "Enviar",
          export_pdf: "Exportar PDF",
          export_csv: "Exportar CSV (Excel)",
          email: "Enviar por Email",
          choose_itinerary: "Elijo este itinerario",
          info_header: "Info Chat Â· Astra ğŸŒ",
          info_placeholder: "PregÃºntame lo que quierasâ€¦",
          loading_text: "âœ¨ Astra estÃ¡ creando tu itinerario completoâ€¦ Esto puede tardar varios minutos. No cierres esta pestaÃ±a: estÃ¡s ahorrando horas de planificaciÃ³n.",
          special_placeholder:
`âœ¨ CuÃ©ntale a Astra exactamente cÃ³mo quieres vivir tu viaje.
Esta informaciÃ³n permitirÃ¡ crear un itinerario 100 % alineado contigo.

ğŸï¸ Estilo y actividades â†’ â€œPrefiero naturaleza y paisajes. Evitar museos.â€ / â€œQuiero tours autÃ©nticos, no masivos.â€
ğŸš— Transporte â†’ â€œVoy a rentar un 4x4.â€ / â€œUsarÃ© transporte pÃºblico.â€ / â€œUber o taxi cuando sea necesario.â€
ğŸƒ Ritmo y nivel de aventura â†’ â€œViaje relax.â€ / â€œBalanceado.â€ / â€œAventura extrema.â€
ğŸ§­ Actividades imperdibles â†’ â€œCaza de auroras.â€ / â€œAvistamiento de ballenas.â€ / â€œTour al CÃ­rculo Dorado.â€
âš•ï¸ Salud y restricciones â†’ â€œAsma, movilidad reducida, problemas de rodillas, alergias alimentarias.â€
ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Otros detalles importantes â†’ â€œViajo con niÃ±os pequeÃ±os.â€ / â€œNecesito horarios flexibles.â€ / â€œEvitar caminatas largas.â€

ğŸ“ Entre mÃ¡s detalles indiques, mÃ¡s preciso, fluido y personalizado serÃ¡ tu itinerario.`
        }
      };

      function t(key) {
        const pack = I18N[lang] || I18N.en;
        return (pack && pack[key]) || (I18N.en && I18N.en[key]) || "";
      }

      function setText(el, value) {
        if (!el) return;
        el.textContent = value;
      }

      function setTitle(el, value) {
        if (!el) return;
        el.setAttribute("title", value);
      }

      function setPlaceholder(el, value) {
        if (!el) return;
        el.setAttribute("placeholder", value);
      }

      function setLabelLeadingTextForControl(controlId, value) {
        const control = document.getElementById(controlId);
        const label = control && control.closest("label");
        if (!label) return;

        // intenta reemplazar el primer nodo de texto "no vacÃ­o" dentro del label
        for (let i = 0; i < label.childNodes.length; i++) {
          const n = label.childNodes[i];
          if (n && n.nodeType === Node.TEXT_NODE && n.textContent && n.textContent.trim().length) {
            n.textContent = value + "\n";
            return;
          }
        }
        // si no encontrÃ³, lo inserta al inicio
        label.insertBefore(document.createTextNode(value + "\n"), label.firstChild);
      }

      function setSelectOptionText(selectEl, value, labelText) {
        if (!selectEl) return;
        const opt = selectEl.querySelector(`option[value="${CSS.escape(value)}"]`);
        if (opt) opt.textContent = labelText;
      }

      function applyI18n() {
        // Sidebar titles
        setText(document.querySelector(".sidebar h2"), t("planner_title"));
        setText(document.querySelector(".sidebar section.box h3"), t("destinations"));
        setText(document.getElementById("add-city-btn"), t("add_city"));
        setText(document.getElementById("save-destinations"), t("save_destinations"));
        setText(document.getElementById("reset-planner"), t("reset_planning"));

        // Special conditions
        setText(document.querySelector(".special-conditions h3"), t("special_title"));
        setPlaceholder(document.getElementById("special-conditions"), t("special_placeholder"));

        // Travelers section
        // (tÃ­tulo del section: el primer h3 despuÃ©s del special-conditions ya existe en HTML: "Viajeros")
        // lo seleccionamos de forma segura por ubicaciÃ³n: el h3 dentro del section que contiene #traveler-mode
        const travelerMode = document.getElementById("traveler-mode");
        const travelerSection = travelerMode ? travelerMode.closest("section.box") : null;
        if (travelerSection) {
          const h3 = travelerSection.querySelector("h3");
          setText(h3, t("travelers_title"));
        }

        setLabelLeadingTextForControl("traveler-mode", t("who_travel"));
        if (travelerMode) {
          setSelectOptionText(travelerMode, "solo", t("mode_solo"));
          setSelectOptionText(travelerMode, "group", t("mode_group"));
        }

        // SOLO panel labels
        setLabelLeadingTextForControl("solo-gender", t("gender"));
        setLabelLeadingTextForControl("solo-age-range", t("age_range"));

        // SOLO options
        const soloGender = document.getElementById("solo-gender");
        if (soloGender) {
          setSelectOptionText(soloGender, "female", t("female"));
          setSelectOptionText(soloGender, "male", t("male"));
          setSelectOptionText(soloGender, "other", t("other"));
          setSelectOptionText(soloGender, "na", t("na"));
        }
        const soloAge = document.getElementById("solo-age-range");
        if (soloAge) {
          setSelectOptionText(soloAge, "0-2", t("baby"));
          setSelectOptionText(soloAge, "3-5", t("preschool"));
          setSelectOptionText(soloAge, "6-12", t("child"));
          setSelectOptionText(soloAge, "13-17", t("teen"));
          setSelectOptionText(soloAge, "18-24", t("young_adult"));
          setSelectOptionText(soloAge, "25-39", t("adult_25_39"));
          setSelectOptionText(soloAge, "40-54", t("adult_40_54"));
          setSelectOptionText(soloAge, "55-64", t("adult_55_64"));
          setSelectOptionText(soloAge, "65+", t("senior"));
        }

        // GROUP: "Tu informaciÃ³n"
        const yourInfoStrong = document.querySelector("#traveler-group-panel .box strong");
        setText(yourInfoStrong, t("your_info"));
        setLabelLeadingTextForControl("me-gender", t("gender"));
        setLabelLeadingTextForControl("me-age-range", t("age_range"));

        const meGender = document.getElementById("me-gender");
        if (meGender) {
          setSelectOptionText(meGender, "female", t("female"));
          setSelectOptionText(meGender, "male", t("male"));
          setSelectOptionText(meGender, "other", t("other"));
          setSelectOptionText(meGender, "na", t("na"));
        }
        const meAge = document.getElementById("me-age-range");
        if (meAge) {
          setSelectOptionText(meAge, "0-2", t("baby"));
          setSelectOptionText(meAge, "3-5", t("preschool"));
          setSelectOptionText(meAge, "6-12", t("child"));
          setSelectOptionText(meAge, "13-17", t("teen"));
          setSelectOptionText(meAge, "18-24", t("young_adult"));
          setSelectOptionText(meAge, "25-39", t("adult_25_39"));
          setSelectOptionText(meAge, "40-54", t("adult_40_54"));
          setSelectOptionText(meAge, "55-64", t("adult_55_64"));
          setSelectOptionText(meAge, "65+", t("senior"));
        }

        // GROUP: Perfiles de viajeros + botones
        const profilesHeader = document.querySelector("#traveler-group-panel .box strong[style*='font-size:.95rem']");
        // Nota: el selector anterior tambiÃ©n puede pegarle a "Tu informaciÃ³n"; por eso el de arriba ya se setea y acÃ¡ buscamos el segundo
        if (travelerSection) {
          const strongs = travelerSection.querySelectorAll("#traveler-group-panel strong");
          if (strongs && strongs.length >= 2) setText(strongs[1], t("traveler_profiles"));
        }
        setText(document.getElementById("traveler-add"), t("add"));
        setText(document.getElementById("traveler-remove"), t("remove"));

        // Perfil 1 labels (texto visible)
        const traveler1Strong = document.querySelector("#traveler-profiles .traveler-profile strong");
        setText(traveler1Strong, t("traveler_1"));
        const companionSpan = document.querySelector("#traveler-profiles .traveler-profile span");
        setText(companionSpan, t("companion"));

        // Perfil 1 selects (labels)
        const profGender = document.querySelector("#traveler-profiles .traveler-profile select.traveler-gender");
        const profAge = document.querySelector("#traveler-profiles .traveler-profile select.traveler-age-range");
        if (profGender) {
          const lbl = profGender.closest("label");
          if (lbl) {
            // reemplaza "GÃ©nero"
            for (let i = 0; i < lbl.childNodes.length; i++) {
              const n = lbl.childNodes[i];
              if (n && n.nodeType === Node.TEXT_NODE && n.textContent && n.textContent.trim().length) {
                n.textContent = t("gender") + "\n";
                break;
              }
            }
          }
          setSelectOptionText(profGender, "female", t("female"));
          setSelectOptionText(profGender, "male", t("male"));
          setSelectOptionText(profGender, "other", t("other"));
          setSelectOptionText(profGender, "na", t("na"));
        }
        if (profAge) {
          const lbl = profAge.closest("label");
          if (lbl) {
            for (let i = 0; i < lbl.childNodes.length; i++) {
              const n = lbl.childNodes[i];
              if (n && n.nodeType === Node.TEXT_NODE && n.textContent && n.textContent.trim().length) {
                n.textContent = t("age_range") + "\n";
                break;
              }
            }
          }
          setSelectOptionText(profAge, "0-2", t("baby"));
          setSelectOptionText(profAge, "3-5", t("preschool"));
          setSelectOptionText(profAge, "6-12", t("child"));
          setSelectOptionText(profAge, "13-17", t("teen"));
          setSelectOptionText(profAge, "18-24", t("young_adult"));
          setSelectOptionText(profAge, "25-39", t("adult_25_39"));
          setSelectOptionText(profAge, "40-54", t("adult_40_54"));
          setSelectOptionText(profAge, "55-64", t("adult_55_64"));
          setSelectOptionText(profAge, "65+", t("senior"));
        }

        // Nota MVP (p final dentro del box de perfiles)
        const mvpP = document.querySelector("#traveler-group-panel p");
        setText(mvpP, t("mvp_note"));

        // Main titles/buttons
        setText(document.querySelector(".itinerary-head h2"), t("itinerary_title"));
        setTitle(document.getElementById("info-chat-floating"), t("open_info_chat"));
        setText(document.getElementById("start-planning"), t("start_planning"));
        setPlaceholder(document.getElementById("chat-input"), t("type_message"));
        setText(document.getElementById("send-btn"), t("send"));

        setText(document.getElementById("btn-pdf"), t("export_pdf"));
        setText(document.getElementById("btn-csv"), t("export_csv"));
        setText(document.getElementById("btn-email"), t("email"));
        setText(document.getElementById("confirm-itinerary"), t("choose_itinerary"));

        // Info Chat modal texts
        setText(document.querySelector("#info-chat-modal .info-chat-header h3"), t("info_header"));
        setPlaceholder(document.getElementById("info-chat-input"), t("info_placeholder"));
        setText(document.getElementById("info-chat-send"), t("send"));

        // Loading overlay text
        const loadingP = document.querySelector("#loading-overlay p");
        setText(loadingP, t("loading_text"));
      }

      // âœ… Auto-height: emite la altura al parent (Webflow) para que el iframe se ajuste
      function postHeight() {
        try {
          const h = Math.max(
            document.documentElement.scrollHeight || 0,
            document.body.scrollHeight || 0
          );
          window.parent && window.parent.postMessage(
            { type: "ITBMO_PLANNER_HEIGHT", height: h },
            "*"
          );
        } catch (_) {}
      }

      // ResizeObserver para cambios dinÃ¡micos (itinerario, chat, etc.)
      try {
        const ro = new ResizeObserver(function () {
          postHeight();
        });
        ro.observe(document.body);
      } catch (_) {
        // fallback
        window.addEventListener("load", postHeight);
        window.addEventListener("resize", postHeight);
        setInterval(postHeight, 1500);
      }

      // Primera mediciÃ³n rÃ¡pida
      window.addEventListener("load", function () {
        applyI18n();
        postHeight();
        setTimeout(postHeight, 300);
        setTimeout(postHeight, 900);
      });

      /* =========================================================
         âœ… MVP: UI viajeros (solo HTML/CSS por ahora)
         - Solo: muestra panel solo
         - AcompaÃ±ado: muestra panel grupo
         (La integraciÃ³n con el intake del planner se hace luego en JS)
      ========================================================= */
      const modeSel = document.getElementById("traveler-mode");
      const soloPanel = document.getElementById("traveler-solo-panel");
      const groupPanel = document.getElementById("traveler-group-panel");

      if (modeSel && soloPanel && groupPanel) {
        modeSel.addEventListener("change", () => {
          const v = (modeSel.value || "").toLowerCase();
          if (v === "solo") {
            soloPanel.style.display = "block";
            groupPanel.style.display = "none";
          } else if (v === "group") {
            soloPanel.style.display = "none";
            groupPanel.style.display = "block";
          } else {
            soloPanel.style.display = "none";
            groupPanel.style.display = "none";
          }
          postHeight();
        });
      }
    })();
  </script>

  <!-- jsPDF (required for PDF export) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- jsPDF AutoTable (required for tables) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<!-- Tu JS del planner (despuÃ©s de los dos de arriba) -->
<script src="./planner.js?v=57"></script>
 
</body>
</html>
