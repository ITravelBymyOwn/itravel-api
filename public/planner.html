<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ITravelByMyOwn ¬∑ Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://cdn.prod.website-files.com/img/favicon.ico" />
  <link rel="stylesheet" href="./planner.css?v=57" />

  <!-- Tipograf√≠a -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous" />
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
  <script>
    WebFont.load({ google: { families: ["Inter:400,500,600,700"] } });
  </script>
</head>
<body>
  <!-- TOPBAR -->
  <div class="topbar">
    <!-- ‚úÖ Brand estilo logo (2 l√≠neas) -->
    <div class="brand brand-logo" aria-label="I Travel By My Own">
      <div class="brand-line-1">I Travel</div>
      <div class="brand-line-2">By My Own</div>
    </div>

    <!-- ‚úÖ MVP: Se elimina bot√≥n de topbar para dejar SOLO el del Itinerario -->
    <!-- <button id="info-chat-toggle" class="btn info-chat-btn pulse" title="Open Info Chat">üí¨ Info Chat</button> -->
  </div>

  <div id="planner-grid">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h2>Planificador</h2>

      <section class="box">
        <h3>Destinos</h3>
        <div id="city-list"></div>
        <div class="row-actions">
          <button class="btn ghost" id="add-city-btn">+ Agregar ciudad</button>
        </div>
        <button class="btn primary w-100" id="save-destinations">Guardar destinos</button>
        <!-- üÜï Bot√≥n de reinicio reubicado -->
        <button id="reset-planner" class="btn warn w-100" style="margin-top:0.5rem;" disabled>
          Reiniciar planificaci√≥n
        </button>
      </section>

      <section class="box special-conditions">
        <h3>Preferencias / Restricciones / Condiciones especiales</h3>
        <textarea id="special-conditions" placeholder="‚ú® Cu√©ntale a Astra exactamente c√≥mo quieres vivir tu viaje.
Esta informaci√≥n permitir√° crear un itinerario 100 % alineado contigo.

üèûÔ∏è Estilo y actividades ‚Üí ‚ÄúPrefiero naturaleza y paisajes. Evitar museos.‚Äù / ‚ÄúQuiero tours aut√©nticos, no masivos.‚Äù
üöó Transporte ‚Üí ‚ÄúVoy a rentar un 4x4.‚Äù / ‚ÄúUsar√© transporte p√∫blico.‚Äù / ‚ÄúUber o taxi cuando sea necesario.‚Äù
üèÉ Ritmo y nivel de aventura ‚Üí ‚ÄúViaje relax.‚Äù / ‚ÄúBalanceado.‚Äù / ‚ÄúAventura extrema.‚Äù
üß≠ Actividades imperdibles ‚Üí ‚ÄúCaza de auroras.‚Äù / ‚ÄúAvistamiento de ballenas.‚Äù / ‚ÄúTour al C√≠rculo Dorado.‚Äù
‚öïÔ∏è Salud y restricciones ‚Üí ‚ÄúAsma, movilidad reducida, problemas de rodillas, alergias alimentarias.‚Äù
üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Otros detalles importantes ‚Üí ‚ÄúViajo con ni√±os peque√±os.‚Äù / ‚ÄúNecesito horarios flexibles.‚Äù / ‚ÄúEvitar caminatas largas.‚Äù

üìù Entre m√°s detalles indiques, m√°s preciso, fluido y personalizado ser√° tu itinerario."></textarea>
      </section>

      <!-- ‚úÖ NUEVO: Viajeros (compacto con dropdown) -->
      <section class="box">
        <h3>Viajeros</h3>

        <!-- Dropdown tipo ‚Äún√∫mero de d√≠as‚Äù (referencia visual en el UI) -->
        <label style="display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
          ¬øCon qui√©n viajas?
          <select id="traveler-mode" class="btn" style="padding:.55rem .7rem; border-radius:.55rem; background:#fff; text-align:left;">
            <option value="" selected disabled></option>
            <option value="solo">Viajo solamente yo</option>
            <option value="group">Viajo acompa√±ado</option>
          </select>
        </label>

        <!-- Panel SOLO -->
        <div id="traveler-solo-panel" style="display:none; margin-top:.85rem;">
          <div style="display:flex; gap:.6rem; flex-wrap:wrap;">
            <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
              G√©nero
              <select id="solo-gender" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                <option value="" selected disabled></option>
                <option value="female">Femenino</option>
                <option value="male">Masculino</option>
                <option value="other">Otro</option>
                <option value="na">Prefiero no decirlo</option>
              </select>
            </label>

            <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
              Rango de edad
              <select id="solo-age-range" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                <option value="" selected disabled></option>
                <option value="0-5">Infante / Preescolar (0‚Äì5)</option>
                <option value="6-12">Ni√±o (6‚Äì12)</option>
                <option value="13-17">Joven (13‚Äì17)</option>
                <option value="18-29">Adulto joven (18‚Äì29)</option>
                <option value="30-44">Adulto (30‚Äì44)</option>
                <option value="45-59">Adulto (45‚Äì59)</option>
                <option value="60-69">Adulto mayor (60‚Äì69)</option>
                <option value="70+">Mayor (70+)</option>
              </select>
            </label>
          </div>
        </div>

        <!-- Panel ACOMPA√ëADO -->
        <div id="traveler-group-panel" style="display:none; margin-top:.85rem;">
          <div class="box" style="margin:0; padding:.9rem; border-style:dashed;">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:.75rem;">
              <strong style="font-size:.95rem;">Perfiles de viajeros</strong>
              <!-- MVP: el JS luego generar√° perfiles autom√°ticamente.
                   Por ahora dejamos contenedor + botones opcionales para futuro -->
              <div style="display:flex; gap:.4rem;">
                <button id="traveler-add" class="btn ghost" type="button" style="padding:.45rem .7rem;">+ Agregar</button>
                <button id="traveler-remove" class="btn ghost" type="button" style="padding:.45rem .7rem;">‚àí Quitar</button>
              </div>
            </div>

            <div id="traveler-profiles" style="display:grid; grid-template-columns:1fr; gap:.75rem; margin-top:.75rem;">
              <!-- Perfil 1 -->
              <div class="traveler-profile" style="border:1px solid #ccc; border-radius:.8rem; padding:.75rem;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:.5rem;">
                  <strong style="font-size:.9rem;">Viajero 1</strong>
                  <span style="font-size:.85rem; color:rgba(11,31,59,.65);">Acompa√±ante</span>
                </div>
                <div style="display:flex; gap:.6rem; flex-wrap:wrap;">
                  <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
                    G√©nero
                    <select class="traveler-gender" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                      <option value="" selected disabled></option>
                      <option value="female">Femenino</option>
                      <option value="male">Masculino</option>
                      <option value="other">Otro</option>
                      <option value="na">Prefiero no decirlo</option>
                    </select>
                  </label>

                  <label style="flex:1; min-width:160px; display:flex; flex-direction:column; gap:.25rem; font-size:.9rem; font-weight:600;">
                    Rango de edad
                    <select class="traveler-age-range" style="padding:.55rem .7rem; border:1px solid #ccc; border-radius:.55rem; background:#fff;">
                      <option value="" selected disabled></option>
                      <option value="0-5">Infante / Preescolar (0‚Äì5)</option>
                      <option value="6-12">Ni√±o (6‚Äì12)</option>
                      <option value="13-17">Joven (13‚Äì17)</option>
                      <option value="18-29">Adulto joven (18‚Äì29)</option>
                      <option value="30-44">Adulto (30‚Äì44)</option>
                      <option value="45-59">Adulto (45‚Äì59)</option>
                      <option value="60-69">Adulto mayor (60‚Äì69)</option>
                      <option value="70+">Mayor (70+)</option>
                    </select>
                  </label>
                </div>
              </div>
              <!-- /Perfil 1 -->
            </div>

            <p style="margin:.75rem 0 0; font-size:.85rem; color:rgba(11,31,59,.68);">
              *En el MVP, estos perfiles se usar√°n para personalizar el itinerario. La l√≥gica se conecta en JS despu√©s.
            </p>
          </div>
        </div>

        <!-- ‚úÖ Compatibilidad: mantenemos el grid original oculto (por ahora) para no romper JS actual -->
        <div id="traveler-grid" style="display:none;">
          <label>Adultos (18‚Äì64)<input id="p-adults" type="number" min="0" value="1"></label>
          <label>J√≥venes (13‚Äì17)<input id="p-young" type="number" min="0" value="0"></label>
          <label>Ni√±os (6‚Äì12)<input id="p-children" type="number" min="0" value="0"></label>
          <label>Infantes (0‚Äì5)<input id="p-infants" type="number" min="0" value="0"></label>
          <label>Mayores (65+)<input id="p-seniors" type="number" min="0" value="0"></label>
        </div>
      </section>

      <!-- ‚úÖ Se elimin√≥ la secci√≥n de Presupuesto del sidebar -->
    </aside>

    <!-- MAIN -->
    <main class="main">
      <section class="box itinerary-section">

        <!-- ‚úÖ Header: T√≠tulo + bot√≥n Info Chat arriba -->
        <div class="itinerary-head">
          <h2>Itinerario</h2>

          <!-- ‚úÖ Bot√≥n Info Chat (WOW) en la posici√≥n solicitada -->
          <button id="info-chat-floating" class="info-chat-floating pulse" title="Open Info Chat">
            ‚ú®üí¨ Info Chat
          </button>
        </div>

        <div class="itinerary-actions">
          <button id="start-planning" class="btn primary" disabled>Iniciar planificaci√≥n</button>
        </div>

        <div id="chat-container" class="chat" style="display:none;">
          <div id="chat-messages" class="chat-messages" aria-live="polite"></div>
          <div class="chat-input">
            <input id="chat-input" type="text" placeholder="Escribe tu mensaje..." />
            <button id="send-btn" class="btn primary">Enviar</button>
          </div>
        </div>

        <div class="city-tabs" id="city-tabs"></div>
        <div id="itinerary-container"></div>

        <div class="toolbar">
          <button class="btn" id="btn-pdf">Exportar PDF</button>

          <!-- üÜï MVP: CSV para Excel -->
          <button class="btn" id="btn-csv">Exportar CSV (Excel)</button>

          <button class="btn" id="btn-email">Enviar por Email</button>

          <!-- ‚úÖ MVP: ocultos (se reactivan despu√©s) -->
          <!--
          <button class="btn" id="btn-maps">Mapas</button>
          <button class="btn" id="btn-transport">Transporte</button>
          <button class="btn" id="btn-weather">Clima</button>
          <button class="btn" id="btn-clothing">Ropa</button>
          <button class="btn" id="btn-restaurants">Restaurantes</button>
          <button class="btn" id="btn-gas">Gasolineras</button>
          <button class="btn" id="btn-bathrooms">Ba√±os</button>
          <button class="btn" id="btn-lodging">Hospedaje</button>
          <button class="btn" id="btn-localinfo">Info Local</button>
          -->
        </div>

        <button id="confirm-itinerary" class="btn primary w-100" style="margin-top:1rem;">Elijo este itinerario</button>
      </section>
    </main>
  </div>

  <footer class="footer">
    ¬© 2026 ITravelByMyOwn
  </footer>

  <!-- Modal Info Chat -->
  <div id="info-chat-modal" class="info-chat-modal" style="display:none;">
    <div class="info-chat-panel">
      <div class="info-chat-header">
        <h3>Info Chat ¬∑ Astra üåç</h3>
        <button id="info-chat-close" class="btn ghost">‚úñ</button>
      </div>
      <div id="info-chat-messages" class="chat-messages"></div>
      <div class="chat-input">
        <textarea id="info-chat-input" placeholder="Ask me anything about travel..." rows="1"></textarea>
        <button id="info-chat-send" class="btn primary">Send</button>
      </div>
    </div>
  </div>

  <!-- Overlay de carga -->
  <div id="loading-overlay" style="display:none;">
    <div class="loader">
      <div class="hourglass"></div>

      <!-- ‚úÖ Mensaje solicitado (nota: si el JS lo pisa, hay que cambiar el string en JS) -->
      <p>‚ú® Astra est√° creando tu itinerario completo‚Ä¶ Esto puede tardar varios minutos. No cierres esta pesta√±a: est√°s ahorrando horas de planificaci√≥n.</p>
    </div>
  </div>

  <!-- üß† Indicador estilo ChatGPT (Planner) -->
  <div id="thinking-indicator">
    <span></span><span></span><span></span>
  </div>

  <!-- üß† Indicador estilo ChatGPT (Info Chat) -->
  <div id="thinking-indicator-info">
    <span></span><span></span><span></span>
  </div>

  <script>
    (function () {
      // ‚úÖ Idioma: por ahora EN primero, luego ES con &lang=es en el iframe src.
      const params = new URLSearchParams(window.location.search);
      const lang = (params.get("lang") || "en").toLowerCase().slice(0, 2);
      document.documentElement.setAttribute("lang", lang);
      window.ITBMO_LANG = lang;

      // ‚úÖ Auto-height: emite la altura al parent (Webflow) para que el iframe se ajuste
      function postHeight() {
        try {
          const h = Math.max(
            document.documentElement.scrollHeight || 0,
            document.body.scrollHeight || 0
          );
          window.parent && window.parent.postMessage(
            { type: "ITBMO_PLANNER_HEIGHT", height: h },
            "*"
          );
        } catch (_) {}
      }

      // ResizeObserver para cambios din√°micos (itinerario, chat, etc.)
      try {
        const ro = new ResizeObserver(function () {
          postHeight();
        });
        ro.observe(document.body);
      } catch (_) {
        // fallback
        window.addEventListener("load", postHeight);
        window.addEventListener("resize", postHeight);
        setInterval(postHeight, 1500);
      }

      // Primera medici√≥n r√°pida
      window.addEventListener("load", function () {
        postHeight();
        setTimeout(postHeight, 300);
        setTimeout(postHeight, 900);
      });

      /* =========================================================
         ‚úÖ MVP: UI viajeros (solo HTML/CSS por ahora)
         - Solo: muestra panel solo
         - Acompa√±ado: muestra panel grupo
         (La integraci√≥n con el intake del planner se hace luego en JS)
      ========================================================= */
      const modeSel = document.getElementById("traveler-mode");
      const soloPanel = document.getElementById("traveler-solo-panel");
      const groupPanel = document.getElementById("traveler-group-panel");

      if (modeSel && soloPanel && groupPanel) {
        modeSel.addEventListener("change", () => {
          const v = (modeSel.value || "").toLowerCase();
          if (v === "solo") {
            soloPanel.style.display = "block";
            groupPanel.style.display = "none";
          } else if (v === "group") {
            soloPanel.style.display = "none";
            groupPanel.style.display = "block";
          } else {
            soloPanel.style.display = "none";
            groupPanel.style.display = "none";
          }
          postHeight();
        });
      }
    })();
  </script>

  <script src="./planner.js?v=57"></script>
</body>
</html>
